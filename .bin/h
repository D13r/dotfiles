#!/bin/bash
set -o nounset -o pipefail -o errexit

host="$1"

# For 'h user@host ^', upload SSH public key - easier than retyping it
if [[ $# -eq 2 ]] && [[ $2 = '^' ]]; then
    exec ssh-copy-id "$host"
fi

# For 'h user@host X', close the master connection
if [[ $# -eq 2 ]] && [[ $2 = 'X' ]]; then
    exec ssh -O stop "$host"
fi

exec ssh -o ForwardAgent=yes -o StrictHostKeyChecking=accept-new "$host"
