Include config_local

#---------------------------------------
# djm.me
#---------------------------------------

Host kara.djm.me kara k
    Hostname kara.djm.me
    ForwardX11 yes

Host maria.djm.me maria m
    Hostname maria.djm.me
    ForwardX11 yes

Host pi.djm.me pi
    Hostname pi.djm.me
    User pi
    ForwardX11 yes

Host rainbow.djm.me rainbow
    Hostname rainbow.djm.me
    User root

# Rainbow VMs (share a single IPv4)
Host red.djm.me red
    Hostname private.red.djm.me
    ProxyJump rainbow

Host orange.djm.me orange
    Hostname private.orange.djm.me
    ProxyJump rainbow

Host yellow.djm.me yellow
    Hostname private.yellow.djm.me
    ProxyJump rainbow

Host green.djm.me green
    Hostname private.green.djm.me
    ProxyJump rainbow

Host cyan.djm.me cyan
    Hostname private.cyan.djm.me
    ProxyJump rainbow

Host blue.djm.me blue
    Hostname private.blue.djm.me
    ProxyJump rainbow

Host violet.djm.me violet
    Hostname private.violet.djm.me
    ProxyJump rainbow

Host white.djm.me white
    Hostname private.white.djm.me
    ProxyJump rainbow

Host black.djm.me black
    Hostname private.black.djm.me
    ProxyJump rainbow

Host gold.djm.me gold
    Hostname private.gold.djm.me
    ProxyJump rainbow

Host silver.djm.me silver
    Hostname private.silver.djm.me
    ProxyJump rainbow

Host bronze.djm.me bronze
    Hostname private.bronze.djm.me
    ProxyJump rainbow

Host magenta.djm.me magenta
    Hostname private.magenta.djm.me
    ProxyJump rainbow

Host indigo.djm.me indigo
    Hostname private.indigo.djm.me
    ProxyJump rainbow

# Rainbox is also only accessible via a Hetzner server
Host rainbox.djm.me rainbox
    Hostname rainbox.djm.me
    Port 23
    User u364797
    ProxyJump rainbow

#---------------------------------------
# maths.ox.ac.uk
#---------------------------------------

Host beulah-penguin.maths.ox.ac.uk beulah-penguin bp b
    Hostname beulah-penguin.maths.ox.ac.uk
    User miller
    ForwardX11 yes

Host bramall-lane.maths.ox.ac.uk bramall-lane bl wfs
    Hostname bramall-lane.maths.ox.ac.uk

Host courses.maths.ox.ac.uk courses moo
    Hostname courses.maths.ox.ac.uk

Host door-entry.maths.ox.ac.uk door-entry door de
    Hostname door-entry.maths.ox.ac.uk

Host gate.maths.ox.ac.uk gate g
    Hostname gate.maths.ox.ac.uk
    User miller
    ForwardX11 yes

Host puppet.maths.ox.ac.uk puppet pup
    Hostname puppet.maths.ox.ac.uk

Host syndrome.maths.ox.ac.uk syndrome syn
    Hostname syndrome.maths.ox.ac.uk
    User miller
    ForwardX11 yes

Host trent-bridge.maths.ox.ac.uk trent-bridge mis tb
    Hostname trent-bridge.maths.ox.ac.uk

Host webdev.maths.ox.ac.uk webdev dev d
    Hostname webdev.maths.ox.ac.uk
    ForwardX11 yes

Host workflow.maths.ox.ac.uk workflow wf
    Hostname workflow.maths.ox.ac.uk

Host www.maths.ox.ac.uk www mi
    # Doesn't allow IPv6 connections yet (Apr 2023)
    AddressFamily inet
    # Using the service IP doesn't currently work via gate, presumably because of IPv6 again (May 2023)
    # When it does work, update the port forwarding below too
    Hostname trimpot.maths.ox.ac.uk

#---------------------------------------
# Miscellaneous
#---------------------------------------

Host localhost local lh
    Hostname localhost
    # Maths servers don't allow IPv6 connections yet, but 'localhost' defaults to ::1 (Apr 2023)
    AddressFamily inet
    ForwardAgent yes
    ForwardX11 yes
    IdentitiesOnly no

Host daydreamerphotos.com ddp
    Hostname daydreamerphotos.com
    User daydream
    ForwardAgent yes

Host my.daydreamerphotos.com mddp
    Hostname my.daydreamerphotos.com
    User mydaydre
    ForwardAgent yes

#---------------------------------------
# Special cases
#---------------------------------------

# Automatically wake my desktop when needed, at the expense of a slightly slower connection when it is already awake
Match final host beulah-penguin.maths.ox.ac.uk exec "wake beulah-penguin"

# SOCKS proxy from laptop to MI internal websites (to use with FoxyProxy Standard)
Match final host gate.maths.ox.ac.uk exec "[[ $HOSTNAME = 'Chell' ]]"
    DynamicForward 1080

#---------------------------------------
# Host groups
#---------------------------------------

# These use "Match final" to match hostnames after canonicalisation, allowing
# me to use short hostnames without specifying every possible hostname here
Match final host *.djm.me
    ForwardAgent yes
    User dave

Match final host *.maths.ox.ac.uk
    ForwardAgent yes
    IdentityFile ~/.ssh/mi-dave.pub

Match final host *.maths.ox.ac.uk !host gate.maths.ox.ac.uk exec "[[ $HOSTNAME != *.maths.ox.ac.uk ]]"
    ProxyJump gate

Match final host *.mshome.net
    ForwardAgent yes

#---------------------------------------
# Defaults
#---------------------------------------

Host *
    CanonicalDomains maths.ox.ac.uk djm.me mshome.net
    CanonicalizeHostname yes
    Compression yes
    ForwardX11 no
    ServerAliveInterval 15
    StrictHostKeyChecking accept-new
    UpdateHostKeys yes

    # Don't hash known hosts - it doesn't really add much security since
    # most hosts are also listed in this file and/or Bash history
    HashKnownHosts no

    # Reuse connections
    ControlMaster auto
    ControlPath ~/.ssh/control-master-%r@%h:%p
    ControlPersist 10s

# Note: This must use "Match final" as well, else it overrides the groups above
Match final host *
    ForwardAgent no
    IdentitiesOnly yes
    IdentityFile ~/.ssh/d13r.pub

    # It is more common for me to be connecting as 'root' than as whatever
    # username I happen to be logged into right now, so make that the default
    User root
