Include config_local

#---------------------------------------
# Hosts in the menu
#---------------------------------------

# Lines starting with "##|" are used in ~/.bin/terminal-menu

##| Personal | k | kara.djm.me | Development VM on Chell
Host k kara kara.djm.me
    Hostname kara.djm.me
    User dave
    ForwardX11 yes

##| Personal | m | maria.djm.me | Desktop PC
Host m maria maria.djm.me
    Hostname maria.djm.me
    User dave
    ForwardX11 yes

##| Personal | 7& | seven.djm.me | Production VM (Hetzner)
Host 7 seven seven.djm.me
    Hostname seven.djm.me
    User dave

##| Mathematical Institute | b | beulah-penguin.maths.ox.ac.uk | Desktop PC
Host b bp beulah-penguin beulah-penguin.maths.ox.ac.uk
    Hostname beulah-penguin.maths.ox.ac.uk
    User miller
    ForwardX11 yes

##| Mathematical Institute | e | edgbaston.maths.ox.ac.uk | Development VM
Host e edgbaston edgbaston.maths.ox.ac.uk
    Hostname edgbaston.maths.ox.ac.uk
    ForwardX11 yes

##| Mathematical Institute | q | quicksilver.maths.ox.ac.uk | Compute system
Host q quicksilver quicksilver.maths.ox.ac.uk
    Hostname quicksilver.maths.ox.ac.uk
    User miller
    ForwardX11 yes

##| Mathematical Institute | t | trent-bridge.maths.ox.ac.uk | Main website - staging
Host tb trent-bridge trent-bridge.maths.ox.ac.uk
    Hostname trent-bridge.maths.ox.ac.uk

##| Mathematical Institute | w | www.maths.ox.ac.uk | Main website - live
Host www www.maths.ox.ac.uk

# This is a special case because the menu doesn't use SSH to connect
Host localhost
    ForwardAgent yes
    ForwardX11 yes
    IdentitiesOnly no

#---------------------------------------
# Hosts not in the menu
#---------------------------------------

Host boot boot.djm.me
    Hostname boot.djm.me
    User dave
    ForwardX11 yes

Host bl
    Hostname bramall-lane.maths.ox.ac.uk

Host ddp daydreamerphotos.com
    Hostname daydreamerphotos.com
    User daydream
    ForwardAgent yes

Host gate gate.maths.ox.ac.uk
    Hostname gate.maths.ox.ac.uk
    User miller
    ForwardX11 yes

Host mddp my.daydreamerphotos.com
    Hostname my.daydreamerphotos.com
    User mydaydre
    ForwardAgent yes

Host pi pi.djm.me
    Hostname pi.djm.me
    User pi
    ForwardX11 yes

#---------------------------------------
# Port forwarding for DBeaver
#---------------------------------------
# https://github.com/dbeaver/dbeaver/issues/10273
# Can't use a Before Connect script inside Snap because it can't find the 'ssh' executable or the SSH agent socket

Match final host edgbaston.maths.ox.ac.uk exec "[[ $HOSTNAME = 'beulah-penguin.maths.ox.ac.uk' ]]"
    LocalForward 33060 /run/mysqld/mysqld.sock

Match final host cmi.maths.ox.ac.uk exec "[[ $HOSTNAME = 'beulah-penguin.maths.ox.ac.uk' ]]"
    LocalForward 33061 /run/mysqld/mysqld.sock

#---------------------------------------
# Host groups
#---------------------------------------

# These use "Match final" to match hostnames after canonicalisation, allowing
# me to use short hostnames without specifying every possible hostname here
Match final host *.djm.me
    ForwardAgent yes

Match final host *.maths.ox.ac.uk
    ForwardAgent yes
    IdentityFile ~/.ssh/mi-dave.pub

Match final host *.maths.ox.ac.uk !host gate.maths.ox.ac.uk exec "[[ $HOSTNAME != *.maths.ox.ac.uk ]]"
    ProxyJump gate

#---------------------------------------
# Defaults
#---------------------------------------

Host *
    CanonicalDomains maths.ox.ac.uk djm.me
    CanonicalizeHostname yes
    Compression yes
    ForwardX11 no
    ServerAliveInterval 15
    UpdateHostKeys yes

    # It is more common for me to be connecting as 'root' than as whatever
    # username I happen to be logged into right now, so make that the default
    User root

    # Don't hash known hosts - it doesn't really add much security since
    # most hosts are also listed in this file and/or Bash history
    HashKnownHosts no

    # Reuse connections
    ControlMaster auto
    ControlPath ~/.ssh/control-master-%r@%h:%p
    ControlPersist 10s

# Note: This must use "Match final" as well, else it overrides the groups above
Match final host *
    ForwardAgent no
    IdentitiesOnly yes
    IdentityFile ~/.ssh/d13r.pub
