#!/bin/bash
set -o errexit -o pipefail -o nounset

PATH="$HOME/.bin:$PATH"

source ~/.bash/color.bash

# No need to check for updates today
date +%Y%m%d > ~/.cfg_last_update

# Run the post-update script too
color lblue 'Running post-update script'
~/.dotfiles/post-update

# Fix WSL permissions (defaults to umask 000)
if is-wsl; then
    color lblue 'Fixing WSL permissions'
    umask 002
    chmod o-w -R "$HOME"

    sudo tee /etc/wsl.conf >/dev/null <<END
[automount]
options = "metadata,umask=0022"
END
fi

# Reload Bash
exec bash -l
